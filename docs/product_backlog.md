# プロダクトバックログ: Jiro-Rimi Cup

## 開発フェーズ概要

| フェーズ | 目標 | ステータス |
|---------|------|-----------|
| **Phase 1** | 大会のエントリーができる | 🟡 In Progress |
| **Phase 2** | 予選を進行できる | ⚪ Backlog |
| **Phase 3** | グランドファイナルを進行できる | ⚪ Backlog |

### ステータス凡例

| ステータス | 説明 |
|-----------|------|
| ⚪ Backlog | 未着手（将来のフェーズ） |
| 🔵 Not Started | 未着手（現フェーズ） |
| 🟡 In Progress | 進行中 |
| 🟢 Done | 完了 |
| 🔴 Blocked | ブロック中 |

---

## Phase 1: 大会のエントリーができる

### Epic 1.1: プロジェクト基盤構築

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 1.1.1 | Supabaseプロジェクト初期設定 | Supabase プロジェクトを作成し、Auth/Database/Storage/Edge Functionsを有効化 | ダッシュボードでプロジェクトが作成されている | 🟢 Done |
| 1.1.2 | フロントエンド環境構築 | Next.js (App Router) + TypeScript でプロジェクトを初期化 | `next@16.1.1` と `typescript@5.9.3` を使用し、`packageManager` は `pnpm@10.28.0`、Node は `>=20.9.0`、`pnpm dev` でローカル起動できる | 🟢 Done |
| 1.1.3 | バックエンド環境構築 | Supabase CLI によるローカル開発環境を構築 | ローカルでSupabaseが動作する | 🟢 Done |
| 1.1.4 | データベース設計 (Schema) | ユーザー/大会/予選/エントリーのテーブル定義 (SQL) | DDLまたはER図が存在する | 🟢 Done |
| 1.1.4a | データベースマイグレーション適用 | 設計書に基づくマイグレーションファイルを作成し適用 | マイグレーションファイルが作成され、ローカルで動作する | 🟢 Done |
| 1.1.5 | Row Level Security (RLS) 設計 | 認証・権限に基づくアクセス制御ポリシーを設計 | RLS設計書が存在する | 🟢 Done |
| 1.1.5a | RLS マイグレーション適用 | 設計書に基づくRLSポリシーのマイグレーションを作成し適用 | RLSマイグレーションがローカルで動作する | 🟢 Done |

---

### Epic 1.2: ユーザー認証（REQ-001）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 1.2.1 | Discord OAuth 設定 | Supabase Auth に Discord プロバイダーを設定 | Discord Developer Portal と連携完了 | 🟢 Done |
| 1.2.2 | ログイン画面 | Discord アカウントでログインできる UI を実装 | ログインボタン押下で Discord 認証フローが開始される | 🟢 Done |
| 1.2.3 | 認証状態管理 | ログイン状態をグローバルに管理する仕組みを実装 | ページリロード後もログイン状態が維持される | 🟢 Done |
| 1.2.4 | ログアウト機能 | ログアウトボタンでセッションを終了 | ログアウト後、未認証状態に戻る | 🟢 Done |
| 1.2.5 | ユーザー情報の自動保存 | 初回ログイン時に Discord ID を `profiles` テーブルに保存 | ログイン後、profiles テーブルにレコードが作成される。x_id は暫定値（`PENDING`）で保存 | 🟢 Done |
| 1.2.6 | 本番環境へのデプロイと動作確認 | Vercel への本番デプロイと Discord OAuth の動作確認 | 本番環境でログインフローが正常に動作する | 🟢 Done |

---

### Epic 1.3: プロフィール設定（REQ-002）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 1.3.1 | マイページ画面（基本） | プロフィール情報を表示・編集できる画面を作成 | マイページにアクセスできる | 🟢 Done |
| 1.3.2 | プレイヤー名設定 | ゲーム内プレイヤー名を入力・保存できる | 入力した名前が DB に保存される | 🟢 Done |
| 1.3.3 | X ID 設定 | X ID（必須）を入力・保存できる | バリデーション付きで保存される | 🟢 Done |
| 1.3.4 | 性別設定 | ボーイズ / ガールズ を選択できる | 選択した性別が保存される | 🟢 Done |
| 1.3.5 | ロール優先順位設定 | 5種のロールから3つを選び優先順位付け | 第1〜第3希望が保存される | 🟢 Done |
| 1.3.6 | 初回登録モード | マイページに初回ユーザー向けモードを実装し、必須項目入力完了まで離脱不可にする | 初回ログイン時はサイドメニューが非活性化され、プロフィール完了まで他画面へ遷移できない | 🟢 Done |

---

### Epic 1.4: 大会作成・管理（REQ-003）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 1.4.1 | 運営者権限の付与機能 | 特定ユーザーに運営者権限を付与する仕組み | DB で運営者フラグを管理できる | 🟢 Done |
| 1.4.2 | 管理者向けルート基盤 | サイドメニューに「大会管理」を追加し、管理者のみ表示・アクセス可能にする | 管理者のみサイドメニューに表示され、非管理者の直接アクセスは403になる | 🔵 Not Started |
| 1.4.3 | 大会作成画面 | 大会の基本情報と予選設定を含む作成フォームを実装 | 大会名・性別区分・予選日程・エントリー期限・チェックイン時間帯・試合数・GF進出人数を入力して作成できる | 🔵 Not Started |
| 1.4.4 | 大会一覧画面 | 作成した大会の一覧を表示 | 大会の一覧が表示される | 🔵 Not Started |
| 1.4.5 | 大会編集画面 | 作成済み大会の情報を修正できる画面を実装 | 一覧から編集画面に遷移し、保存した内容が反映される | 🔵 Not Started |

---

### Epic 1.5: 大会エントリー（REQ-004）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 1.5.1 | 大会一覧画面（参加者向け） | 参加可能な大会の一覧を表示 | 性別に合った大会のみ表示される | 🔵 Not Started |
| 1.5.2 | 大会詳細画面 | 大会の情報と予選一覧を表示 | 各予選の日程・エントリー期限が確認できる | 🔵 Not Started |
| 1.5.3 | エントリー機能 | 各予選に個別でエントリーできる | エントリーボタンでエントリー完了 | 🔵 Not Started |
| 1.5.4 | エントリー期限チェック | 期限を過ぎた予選にはエントリー不可 | 期限後はボタンが非活性になる | 🔵 Not Started |
| 1.5.5 | プロフィール未完了チェック | プロフィール未完了ならエントリー不可 | エラーメッセージでマイページに誘導 | 🔵 Not Started |
| 1.5.6 | 性別チェック | プロフィールの性別と大会の性別区分を照合 | 不一致の場合はエントリー不可 | 🔵 Not Started |
| 1.5.7 | エントリーキャンセル機能 | エントリー済みの予選をキャンセルできる | キャンセル後、再エントリー可能 | 🔵 Not Started |
| 1.5.8 | マイエントリー一覧 | 自分がエントリーした予選の一覧を表示 | マイページから確認できる | 🔵 Not Started |

---

### Epic 1.6: エントリー一覧・公開（REQ-005）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 1.6.1 | エントリー一覧画面 | 予選ごとのエントリー者一覧を表示 | プレイヤー名・ロールが表示される | 🔵 Not Started |
| 1.6.2 | 未ログインでの閲覧許可 | 認証なしでもエントリー一覧を閲覧可能 | 未ログイン状態でアクセスできる | 🔵 Not Started |
| 1.6.3 | エントリー人数表示 | 現在のエントリー人数を表示 | リアルタイムで更新される | 🔵 Not Started |
| 1.6.4 | ロール分布表示 | 各ロールのエントリー人数を集計表示 | 円グラフ or 棒グラフで可視化 | 🔵 Not Started |

---

## Phase 1 完了条件

- [ ] Discord 認証でログインできる
- [ ] プロフィール（プレイヤー名、Discord ID、性別、ロール優先順位）を設定できる
- [ ] 運営者が大会・予選を作成できる
- [ ] 参加者が予選にエントリー/キャンセルできる
- [ ] 誰でもエントリー一覧・ロール分布を閲覧できる

---

## Phase 2: 予選を進行できる

### Epic 2.1: DB拡張（予選進行関連）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 2.1.1 | チェックインテーブル追加 | チェックイン情報を管理するテーブルを定義 | ユーザー×予選単位でチェックイン状態を保持できる | ⚪ Backlog |
| 2.1.2 | マッチ・チーム編成テーブル追加 | マッチ情報とチーム編成を管理するテーブルを定義 | マッチごとに2チーム×5人の編成を保持できる | ⚪ Backlog |
| 2.1.3 | 勝敗結果テーブル追加 | 個人単位の勝敗入力とマッチ結果を管理するテーブルを定義 | 個人の入力・多数決の仮結果・運営者確定結果を保持できる | ⚪ Backlog |
| 2.1.4 | 予選・マッチステータス管理 | 予選ステータス（チェックイン受付中→参加者確定→試合進行中→予選終了）とマッチステータス（待機中→進行中→確定済）をDBで管理 | ステータス遷移が正しく動作する | ⚪ Backlog |
| 2.1.5 | RLS拡張（Phase 2） | チェックイン・マッチ・勝敗関連テーブルのアクセス制御 | 運営者のみ管理操作可能、参加者は自分の勝敗入力のみ可能 | ⚪ Backlog |

---

### Epic 2.2: チェックイン（REQ-006）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 2.2.1 | チェックイン画面（参加者向け） | エントリー済み予選のチェックインボタンを表示 | チェックイン可能時間帯にボタンが表示される | ⚪ Backlog |
| 2.2.2 | チェックイン実行 | 参加者がチェックインを実行できる | チェックイン後にステータスが反映される | ⚪ Backlog |
| 2.2.3 | チェックイン時間帯制御 | チェックイン可能時間帯外ではチェックインを不可にする | 時間帯外はボタンが非活性になる | ⚪ Backlog |
| 2.2.4 | チェックイン状況一覧（公開） | チェックイン済みの参加者一覧と人数を表示 | 未ログインユーザーも閲覧可能 | ⚪ Backlog |
| 2.2.5 | 運営者によるチェックイン管理 | 運営者がチェックインの追加・削除を行える | 遅刻者の追加、ドタキャン者の削除ができる | ⚪ Backlog |

---

### Epic 2.3: チーム編成（REQ-007）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 2.3.1 | チーム編成画面（運営者向け） | チェックイン済み参加者一覧からチームを手動編成するUI | 参加者をドラッグ&ドロップ等でチームに配置できる | ⚪ Backlog |
| 2.3.2 | マッチ枠の自動生成 | チェックイン人数に応じて5v5マッチの枠を自動生成 | 人数÷10のマッチ枠が生成される | ⚪ Backlog |
| 2.3.3 | 参加者情報の表示 | 編成画面で各参加者のロール希望・現在の成績を表示 | ロール第1〜第3希望と勝敗数が確認できる | ⚪ Backlog |
| 2.3.4 | AIアシストボタン | AIがロール・成績を考慮したチーム案を自動生成する | ボタン押下でチーム編成が自動的に埋まる | ⚪ Backlog |
| 2.3.5 | 前回構成のデフォルト設定 | 2試合目以降、前回のチーム構成を初期値として表示 | 前回のチーム配置がそのまま表示される | ⚪ Backlog |
| 2.3.6 | チーム編成の確定 | 運営者がチーム編成を確定する | 確定後、マッチが「待機中」ステータスで作成される | ⚪ Backlog |
| 2.3.7 | 第1試合のランダムマッチング | 初回（全員0勝0敗）はランダムにマッチを組む | AIアシスト実行時、第1試合はランダムに編成される | ⚪ Backlog |

---

### Epic 2.4: 試合進行（REQ-008）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 2.4.1 | 試合開始機能（運営者） | 運営者が「試合開始」ボタンで全マッチを一斉に開始 | 全マッチのステータスが「待機中」→「進行中」に変わる | ⚪ Backlog |
| 2.4.2 | 参加者 試合画面 | 試合開始後に対戦相手チームの情報を表示 | 自チームと相手チームのメンバー・ロールが表示される | ⚪ Backlog |
| 2.4.3 | ロビー番号入力 | マッチの10人全員と運営者がロビー番号を入力・閲覧できる | 後勝ち方式で上書き可能、全員に表示される | ⚪ Backlog |
| 2.4.4 | 勝敗入力（参加者） | 各参加者が自分の勝ち/負けを入力できる | 入力後にDBに保存される | ⚪ Backlog |
| 2.4.5 | 多数決による仮結果算出 | 同マッチ内の個人入力から多数決で仮結果を自動算出 | 過半数が一致した場合は仮結果が自動表示される | ⚪ Backlog |
| 2.4.6 | 勝敗不一致の運営者通知 | 5:5等の不一致マッチを運営者にハイライト表示 | 不一致マッチが管理画面で視覚的に識別できる | ⚪ Backlog |
| 2.4.7 | 結果確定機能（運営者） | 全マッチの仮結果を確認し「結果確定」ボタンで確定 | 確定後、マッチのステータスが「確定済」になる | ⚪ Backlog |
| 2.4.8 | 運営者による勝敗入力・変更 | 運営者が各マッチの勝敗を直接入力・変更できる | 多数決結果と異なる結果に変更できる | ⚪ Backlog |
| 2.4.9 | 予選ステータス遷移 | チェックイン受付中→参加者確定→試合進行中→予選終了の遷移を管理 | 各フェーズで適切なUIが表示される | ⚪ Backlog |
| 2.4.10 | リアルタイム更新 | 勝敗入力状況・ロビー番号等をリアルタイムで反映 | Supabase Realtimeで画面が自動更新される | ⚪ Backlog |

---

### Epic 2.5: 運営者 試合進行管理画面（REQ-008-A）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 2.5.1 | 管理画面レイアウト | 予選進行の全体ビューを表示する管理画面 | 現在の予選ステータス・試合番号が表示される | ⚪ Backlog |
| 2.5.2 | 全マッチ一覧表示 | 各マッチのチーム構成・ユーザー名を一覧表示 | 全マッチの概要が一画面で把握できる | ⚪ Backlog |
| 2.5.3 | 勝敗入力状況一覧 | 各ユーザーの入力状況（入力済み/未入力）を表示 | リアルタイムで入力状況が更新される | ⚪ Backlog |
| 2.5.4 | 各ユーザーの成績表示 | 各ユーザーの現在の勝敗数を表示 | チーム編成の参考情報として確認できる | ⚪ Backlog |
| 2.5.5 | 予選進行操作の集約 | 試合開始・結果確定・チーム編成への遷移をまとめる | 管理画面から全ての進行操作ができる | ⚪ Backlog |

---

### Epic 2.6: 成績・ランキング（REQ-009）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 2.6.1 | ランキング画面（公開） | 大会単位のランキングを表示する画面 | 未ログインユーザーも閲覧可能 | ⚪ Backlog |
| 2.6.2 | ランキングのリアルタイム更新 | 各試合の結果確定ごとにランキングを自動更新 | 結果確定後すぐにランキングに反映される | ⚪ Backlog |
| 2.6.3 | 予選ごとの詳細成績表示 | 各予選の試合ごとの成績を表示 | 予選を選択して詳細成績が確認できる | ⚪ Backlog |
| 2.6.4 | 大会総合成績表示 | 全予選を通じた総合成績を表示 | 勝数・敗数・参加試合数が確認できる | ⚪ Backlog |

---

## Phase 2 完了条件

- [ ] 参加者が予選当日にチェックインできる
- [ ] 運営者がチェックインの追加・削除を行える
- [ ] 運営者がチーム編成画面で手動/AIアシストでチームを編成できる
- [ ] 全マッチを一斉に開始し、参加者が対戦情報を確認できる
- [ ] 参加者がロビー番号を入力・閲覧できる
- [ ] 参加者が個人単位で勝敗を入力し、多数決で仮結果が算出される
- [ ] 運営者が結果を確認・確定し、次の試合に進行できる
- [ ] 規定試合数を消化して予選を完了できる
- [ ] 誰でも成績・ランキングを閲覧でき、リアルタイムで更新される

---

## Phase 3: グランドファイナルを進行できる

### Epic 3.1: DB拡張（GF関連）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 3.1.1 | GFテーブル追加 | GF進出者・チーム編成・トーナメントブラケットを管理するテーブルを定義 | 4チーム×5人の編成とダブルエリミのブラケット状態を保持できる | ⚪ Backlog |
| 3.1.2 | トーナメント対戦管理テーブル | ウィナーズ/ルーザーズ/GFの各対戦とその結果を管理 | ブラケットの進行状態と各対戦の勝敗を保持できる | ⚪ Backlog |
| 3.1.3 | RLS拡張（Phase 3） | GF関連テーブルのアクセス制御 | 運営者のみ管理操作可能、GF情報は全体公開で閲覧可能 | ⚪ Backlog |

---

### Epic 3.2: GF進出・チェックイン（REQ-010）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 3.2.1 | GF進出者の自動決定 | 予選ランキング上位N名を自動的にGF進出者として表示 | 大会設定のGF進出人数に基づき進出者が表示される | ⚪ Backlog |
| 3.2.2 | GF進出者一覧画面（公開） | GF進出者の一覧を表示 | 未ログインユーザーも閲覧可能 | ⚪ Backlog |
| 3.2.3 | GFチェックイン | GF進出者がチェックインする機能（予選と同じ仕組みを流用） | チェックイン可能時間帯にチェックインできる | ⚪ Backlog |
| 3.2.4 | 運営者によるGFチェックイン管理 | 運営者がGFチェックインの追加・削除を行える | 予選と同様に管理できる | ⚪ Backlog |

---

### Epic 3.3: GFチーム編成（REQ-010）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 3.3.1 | GFチーム編成画面 | チェックイン済みGF進出者を4チーム×5人に編成するUI | 予選と同様のチーム編成画面で手動配置できる | ⚪ Backlog |
| 3.3.2 | 予選成績の参照表示 | 編成画面でGF進出者の予選成績・ランキング順位を表示 | 成績を見ながらチーム編成の判断ができる | ⚪ Backlog |
| 3.3.3 | GFチーム編成の確定・公開 | 確定したチーム編成をGF参加者・閲覧者に公開 | チーム分け情報が全体公開される | ⚪ Backlog |

---

### Epic 3.4: ダブルエリミネーショントーナメント（REQ-010）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 3.4.1 | トーナメント表の生成 | 4チームのダブルエリミネーションブラケットを生成 | ウィナーズ/ルーザーズ/GFの全対戦枠が生成される | ⚪ Backlog |
| 3.4.2 | トーナメント表画面（公開） | トーナメントの進行状況を表示する画面 | 未ログインユーザーも閲覧可能、リアルタイム更新 | ⚪ Backlog |
| 3.4.3 | 対戦カードの自動進行 | 対戦結果に基づき次の対戦カードを自動決定 | 勝者→次のウィナーズ対戦、敗者→ルーザーズ対戦に自動配置 | ⚪ Backlog |
| 3.4.4 | リセットマッチ対応 | GFでウィナーズ側が敗北した場合にリセットマッチを自動追加 | リセットマッチが発生した場合に対戦枠が追加される | ⚪ Backlog |
| 3.4.5 | GF試合進行（予選流用） | 予選と同じ試合進行機能をGFで利用 | 試合開始・ロビー番号入力・勝敗入力（個人単位+多数決+運営者確定）が動作する | ⚪ Backlog |
| 3.4.6 | GF運営者管理画面 | GFの試合進行を管理する画面（予選管理画面を流用） | トーナメントの進行状況と各対戦の管理ができる | ⚪ Backlog |
| 3.4.7 | 大会結果の確定 | 全対戦完了後に最終順位（優勝〜4位）を確定 | 運営者が大会結果を確定できる | ⚪ Backlog |

---

### Epic 3.5: 過去大会成績（REQ-011）

| ID | バックログアイテム | 説明 | 受け入れ条件 | ステータス |
|----|-------------------|------|-------------|-----------|
| 3.5.1 | 過去大会成績一覧画面 | マイページに過去参加した大会の成績一覧を表示 | 大会名・参加予選数・勝敗数・最終順位が表示される | ⚪ Backlog |
| 3.5.2 | 大会成績の自動集計 | 大会終了時に各参加者の成績を自動集計 | 大会結果確定後に成績が反映される | ⚪ Backlog |

---

## Phase 3 完了条件

- [ ] 予選ランキングからGF進出者が自動決定される
- [ ] GF進出者がチェックインできる
- [ ] 運営者がアプリ上で4チーム×5人のチーム編成を行える
- [ ] ダブルエリミネーショントーナメントが進行できる（リセットマッチ含む）
- [ ] トーナメント表がリアルタイムで公開される
- [ ] 予選と同じ方式で勝敗入力・確定ができる
- [ ] 大会の最終結果（優勝〜4位）を確定できる
- [ ] マイページから過去大会の成績を確認できる

---

## 進捗サマリー

### Phase 1

| Epic | 総数 | Done | In Progress | Not Started |
|------|------|------|-------------|-------------|
| 1.1 プロジェクト基盤構築 | 7 | 7 | 0 | 0 |
| 1.2 ユーザー認証 | 6 | 6 | 0 | 0 |
| 1.3 プロフィール設定 | 6 | 6 | 0 | 0 |
| 1.4 大会作成・管理 | 5 | 1 | 0 | 4 |
| 1.5 大会エントリー | 8 | 0 | 0 | 8 |
| 1.6 エントリー一覧・公開 | 4 | 0 | 0 | 4 |
| **Phase 1 合計** | **36** | **20** | **0** | **16** |

### Phase 2

| Epic | 総数 | Done | In Progress | Not Started |
|------|------|------|-------------|-------------|
| 2.1 DB拡張（予選進行関連） | 5 | 0 | 0 | 5 |
| 2.2 チェックイン | 5 | 0 | 0 | 5 |
| 2.3 チーム編成 | 7 | 0 | 0 | 7 |
| 2.4 試合進行 | 10 | 0 | 0 | 10 |
| 2.5 運営者 試合進行管理画面 | 5 | 0 | 0 | 5 |
| 2.6 成績・ランキング | 4 | 0 | 0 | 4 |
| **Phase 2 合計** | **36** | **0** | **0** | **36** |

### Phase 3

| Epic | 総数 | Done | In Progress | Not Started |
|------|------|------|-------------|-------------|
| 3.1 DB拡張（GF関連） | 3 | 0 | 0 | 3 |
| 3.2 GF進出・チェックイン | 4 | 0 | 0 | 4 |
| 3.3 GFチーム編成 | 3 | 0 | 0 | 3 |
| 3.4 ダブルエリミネーショントーナメント | 7 | 0 | 0 | 7 |
| 3.5 過去大会成績 | 2 | 0 | 0 | 2 |
| **Phase 3 合計** | **19** | **0** | **0** | **19** |
